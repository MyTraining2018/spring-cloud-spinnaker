image::https://circleci.com/gh/spring-cloud/spring-cloud-spinnaker.svg?style=svg["CircleCI", link="https://circleci.com/gh/spring-cloud/spring-cloud-spinnaker"]

image:https://badge.waffle.io/spring-cloud/spring-cloud-spinnaker.png?label=ready&title=Ready["Stories in Ready", link="https://waffle.io/spring-cloud/spring-cloud-spinnaker"]

= Spring Cloud Spinnaker

Spring Cloud Spinnaker is a Spring Boot web application used to deploy all the parts of http://spinnaker.io[Spinnaker]
to a pre-selected space in PCF.

== Running Spring Cloud Spinnaker

To run the app locally on your machine, you have to follow a few steps.

Requirements:

* Either a Mac or Unix based system. (Building the Spinnaker components on Windows won't work, and Cygwin has yet to be tested)
* Java 8 SDK
* git

=== Building Spinnaker

Before you can run this application, you have to build Spinnaker's modules.

1. Clone this repository
1. Run `git submodule init`
1. Run `git submodule update --remote` (only execute this if you have a fresh clone, otherwise it will update the versions)
1. Run `./build_spinnaker.sh all`
+
WARNING: Do NOT interrupt `build_spinnaker.sh` in mid process. Due to the nature of Spinnaker's nebula gradle plugin, the
components cannot be built inside a git submodule. The script temporarily moves each module into /tmp, builds it, then
moves it back. Any interruptions would require reseting the state of your cloned repository.
+
1. Run `./mvnw clean package`
1. Run `cf push spinnaker-deployer -p target/spring-cloud-spinnaker-<version>.jar`

Now you can point your browser at the deployment site of the Spinnaker Deployer, fill outs its settings, and install Spinnaker anywhere!

Visit https://cloud.spring.io/spring-cloud-spinnaker and navigate to the reference docs to use this app.

=== Releasing Spring Cloud Spinnaker

Snapshots are automatically published via https://jenkins.spring.io/view/All/job/spring-cloud-spinnaker[Jenkins] by effectively doing this...

----
$ USERNAME=<user> PASSWORD=<enc artifactory password> ./mvnw -Pdistribute,snapshot,docs clean deploy
----

NOTE: CI builds don't sign artifacts with GPG

To do a release (.RELEASE, .RC?, .M?):

. Check in all changes and ensure there are no edited files.
. Bump up the version in `pom.xml` to the desired version and commit the change.
. `git tag <version>` (like v1.0.0.M1)
. Execute a maven deploy.
* For a milestone: `USERNAME=<user> PASSWORD=<enc artifactory password> ./mvnw -Pdistribute,gpg,milestone,docs clean deploy`
* For a release: `USERNAME=<user> PASSWORD=<enc artifactory password> ./mvnw -Pdistribute,gpg,release,docs clean deploy`
* For a release to maven central: `USERNAME=<user> PASSWORD=<password> ./mvnw -Pdistribute,gpg,central,docs clean deploy -s settings.xml`
. Bump up the version in `pom.xml` again to the next BUILD-SNAPSHOT, and update application.yml as well for each uber JAR to BUILD-SNAPSHOT.
. Commit the change.
. `git push`
. Inspect handiwork at https://repo.spring.io/ or https://oss.sonatype.org/#stagingRepositories

NOTE: A word about reference documentation. Based upon https://github.com/spring-projects/spring-framework/wiki/gradle-build-and-release-faq#user-content-wiki-docs_schema_dist_publication[this], the `distribute` profile contains an artifactory property that is applied to the ZIP file generated by the `docs` profile. A CRON job will scoop up the zipped up docs and unpack them inside the target location.